generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum ComicStatus {
  draft
  published
  completed
  hidden
}

enum ChapterStatus {
  draft
  published
}

enum CommentStatus {
  visible
  hidden
}

enum UserStatus {
  active
  pending
  inactive
}
model Comic {
  id               BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  slug             String        @unique @db.VarChar(255)
  title            String        @db.VarChar(255)
  description      String?       @db.Text
  cover_image      String?       @db.VarChar(500)
  author           String?       @db.VarChar(255)
  status           ComicStatus   @default(draft)
  created_user_id  BigInt?       @db.UnsignedBigInt
  updated_user_id  BigInt?       @db.UnsignedBigInt
  created_at       DateTime      @default(now()) @db.DateTime(0)
  updated_at       DateTime      @updatedAt @db.DateTime(0)
  deleted_at       DateTime?     @db.DateTime(0)

  stats            ComicStats?
  chapters         Chapter[]
  categoryLinks    ComicCategoryOnComic[]
  comments         Comment[]
  reviews          ComicReview[]
  views            ComicView[]

  @@map("comics")
  @@index([slug], map: "idx_slug")
  @@index([status], map: "idx_status")
  @@index([author], map: "idx_author")
  @@index([created_at], map: "idx_created_at")
  @@index([created_user_id], map: "idx_created_user_id")
  @@index([updated_user_id], map: "idx_updated_user_id")
  @@index([deleted_at], map: "idx_deleted_at")
}

model ComicStats {
  comic_id     BigInt   @id @db.UnsignedBigInt
  view_count   BigInt   @default(0) @db.UnsignedBigInt
  follow_count BigInt   @default(0) @db.UnsignedBigInt
  rating_count BigInt   @default(0) @db.UnsignedBigInt
  rating_sum   BigInt   @default(0) @db.UnsignedBigInt
  updated_at   DateTime @default(now()) @updatedAt @db.DateTime(0)

  comic        Comic    @relation(fields: [comic_id], references: [id], onDelete: Cascade)

  @@map("comic_stats")
  @@index([view_count], map: "idx_view_count")
  @@index([follow_count], map: "idx_follow_count")
  @@index([updated_at], map: "idx_updated_at")
}

model Chapter {
  id              BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  comic_id        BigInt        @db.UnsignedBigInt
  team_id         BigInt?       @db.UnsignedBigInt
  title           String        @db.VarChar(255)
  chapter_index   Int
  chapter_label   String?       @db.VarChar(50)
  status          ChapterStatus @default(draft)
  view_count      BigInt        @default(0) @db.UnsignedBigInt
  created_user_id BigInt?       @db.UnsignedBigInt
  updated_user_id BigInt?       @db.UnsignedBigInt
  created_at      DateTime      @default(now()) @db.DateTime(0)
  updated_at      DateTime      @updatedAt @db.DateTime(0)
  deleted_at      DateTime?     @db.DateTime(0)

  comic           Comic         @relation(fields: [comic_id], references: [id], onDelete: Cascade)
  pages           ChapterPage[]
  views           ComicView[]
  comments        Comment[]

  @@map("chapters")
  @@index([comic_id], map: "idx_comic_id")
  @@unique([comic_id, chapter_index], map: "idx_comic_chapter_unique")
  @@index([comic_id, chapter_index], map: "idx_comic_chapter_index")
  @@index([team_id], map: "idx_team_id")
  @@index([status], map: "idx_status")
  @@index([view_count], map: "idx_view_count")
  @@index([created_at], map: "idx_created_at")
  @@index([created_user_id], map: "idx_created_user_id")
  @@index([updated_user_id], map: "idx_updated_user_id")
  @@index([deleted_at], map: "idx_deleted_at")
}

model ComicCategory {
  id              BigInt                 @id @default(autoincrement()) @db.UnsignedBigInt
  name            String                 @db.VarChar(255)
  slug            String                 @unique @db.VarChar(255)
  description     String?                @db.Text
  created_user_id BigInt?                @db.UnsignedBigInt
  updated_user_id BigInt?                @db.UnsignedBigInt
  created_at      DateTime               @default(now()) @db.DateTime(0)
  updated_at      DateTime               @updatedAt @db.DateTime(0)
  deleted_at      DateTime?              @db.DateTime(0)

  comics          ComicCategoryOnComic[]

  @@map("comic_categories")
  @@index([slug], map: "idx_slug")
  @@index([name], map: "idx_name")
  @@index([created_at], map: "idx_created_at")
  @@index([created_user_id], map: "idx_created_user_id")
  @@index([updated_user_id], map: "idx_updated_user_id")
  @@index([deleted_at], map: "idx_deleted_at")
}

model ComicCategoryOnComic {
  comic_id          BigInt          @db.UnsignedBigInt
  comic_category_id BigInt          @db.UnsignedBigInt
  comic             Comic           @relation(fields: [comic_id], references: [id], onDelete: Cascade)
  category          ComicCategory   @relation(fields: [comic_category_id], references: [id], onDelete: Cascade)

  @@id([comic_id, comic_category_id])
  @@map("comic_category")
}

model GeneralConfig {
  id                 BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  site_name          String    @db.VarChar(255)
  site_description   String?   @db.Text
  site_logo          String?   @db.VarChar(500)
  site_favicon       String?   @db.VarChar(500)
  site_email         String?   @db.VarChar(255)
  site_phone         String?   @db.VarChar(20)
  site_address       String?   @db.Text
  site_copyright     String?   @db.VarChar(255)
  timezone           String    @db.VarChar(50)  @default("Asia/Ho_Chi_Minh")
  locale             String    @db.VarChar(10)  @default("vi")
  currency           String    @db.VarChar(10)  @default("VND")
  contact_channels   Json?
  meta_title         String?   @db.VarChar(255)
  meta_keywords      String?   @db.Text
  og_title           String?   @db.VarChar(255)
  og_description     String?   @db.Text
  og_image           String?   @db.VarChar(500)
  canonical_url      String?   @db.VarChar(500)
  google_analytics_id String?  @db.VarChar(50)
  google_search_console String? @db.VarChar(255)
  facebook_pixel_id  String?   @db.VarChar(50)
  twitter_site       String?   @db.VarChar(50)
  created_user_id    BigInt?   @db.UnsignedBigInt
  updated_user_id    BigInt?   @db.UnsignedBigInt
  created_at         DateTime  @default(now()) @db.DateTime(0)
  updated_at         DateTime  @updatedAt @db.DateTime(0)
  deleted_at         DateTime? @db.DateTime(0)

  @@map("general_configs")
  @@index([deleted_at], map: "idx_general_configs_deleted_at")
}

model EmailConfig {
  id             BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  smtp_host      String   @db.VarChar(255)
  smtp_port      Int      @default(587)
  smtp_secure    Boolean  @default(true)
  smtp_username  String   @db.VarChar(255)
  smtp_password  String   @db.VarChar(500)
  from_email     String   @db.VarChar(255)
  from_name      String   @db.VarChar(255)
  reply_to_email String?  @db.VarChar(255)
  created_user_id BigInt? @db.UnsignedBigInt
  updated_user_id BigInt? @db.UnsignedBigInt
  created_at      DateTime @default(now()) @db.DateTime(0)
  updated_at      DateTime @updatedAt @db.DateTime(0)
  deleted_at      DateTime? @db.DateTime(0)

  @@map("email_configs")
  @@index([deleted_at], map: "idx_email_configs_deleted_at")
}

model Comment {
  id              BigInt         @id @default(autoincrement()) @db.UnsignedBigInt
  user_id         BigInt         @db.UnsignedBigInt
  comic_id        BigInt         @db.UnsignedBigInt
  chapter_id      BigInt?        @db.UnsignedBigInt
  parent_id       BigInt?        @db.UnsignedBigInt
  content         String         @db.Text
  status          CommentStatus  @default(visible)
  created_user_id BigInt?        @db.UnsignedBigInt
  updated_user_id BigInt?        @db.UnsignedBigInt
  created_at      DateTime       @default(now()) @db.DateTime(0)
  updated_at      DateTime       @updatedAt @db.DateTime(0)
  deleted_at      DateTime?      @db.DateTime(0)

  comic           Comic          @relation(fields: [comic_id], references: [id], onDelete: Cascade)
  chapter         Chapter?       @relation(fields: [chapter_id], references: [id], onDelete: SetNull)
  user            User           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  parent          Comment?       @relation("CommentToReplies", fields: [parent_id], references: [id], onDelete: Cascade)
  replies         Comment[]      @relation("CommentToReplies")

  @@map("comments")
  @@index([user_id], map: "idx_user_id")
  @@index([comic_id], map: "idx_comic_id")
  @@index([chapter_id], map: "idx_chapter_id")
  @@index([parent_id], map: "idx_parent_id")
  @@index([status], map: "idx_status")
  @@index([created_at], map: "idx_created_at")
  @@index([comic_id, created_at], map: "idx_comic_created")
  @@index([chapter_id, created_at], map: "idx_chapter_created")
  @@index([created_user_id], map: "idx_created_user_id")
  @@index([updated_user_id], map: "idx_updated_user_id")
  @@index([deleted_at], map: "idx_deleted_at")
}

model ComicReview {
  id              BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id         BigInt    @db.UnsignedBigInt
  comic_id        BigInt    @db.UnsignedBigInt
  rating          Int       @db.UnsignedTinyInt
  content         String?   @db.Text
  created_user_id BigInt?   @db.UnsignedBigInt
  updated_user_id BigInt?   @db.UnsignedBigInt
  created_at      DateTime  @default(now()) @db.DateTime(0)
  updated_at      DateTime  @updatedAt @db.DateTime(0)
  deleted_at      DateTime? @db.DateTime(0)

  comic           Comic     @relation(fields: [comic_id], references: [id], onDelete: Cascade)
  user            User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("comic_reviews")
  @@index([user_id], map: "idx_user_id")
  @@index([comic_id], map: "idx_comic_id")
  @@unique([user_id, comic_id], map: "idx_user_comic")
  @@index([rating], map: "idx_rating")
  @@index([created_at], map: "idx_created_at")
  @@index([created_user_id], map: "idx_created_user_id")
  @@index([updated_user_id], map: "idx_updated_user_id")
  @@index([deleted_at], map: "idx_deleted_at")
}

model ChapterPage {
  id          BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  chapter_id  BigInt   @db.UnsignedBigInt
  page_number Int
  image_url   String   @db.VarChar(500)
  width       Int?
  height      Int?
  file_size   BigInt?  @db.UnsignedBigInt
  created_at  DateTime @default(now()) @db.DateTime(0)

  chapter     Chapter  @relation(fields: [chapter_id], references: [id], onDelete: Cascade)

  @@map("chapter_pages")
  @@index([chapter_id], map: "idx_chapter_id")
  @@index([chapter_id, page_number], map: "idx_chapter_page")
  @@unique([chapter_id, page_number], map: "idx_chapter_page_unique")
}

model ComicView {
  id          BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  comic_id    BigInt    @db.UnsignedBigInt
  chapter_id  BigInt?   @db.UnsignedBigInt
  user_id     BigInt?   @db.UnsignedBigInt
  ip          String?   @db.VarChar(45)
  user_agent  String?   @db.VarChar(500)
  created_at  DateTime  @default(now()) @db.DateTime(0)

  comic       Comic     @relation(fields: [comic_id], references: [id], onDelete: Cascade)
  chapter     Chapter?  @relation(fields: [chapter_id], references: [id], onDelete: SetNull)
  user        User?     @relation(fields: [user_id], references: [id], onDelete: SetNull)

  @@map("comic_views")
  @@index([comic_id], map: "idx_comic_id")
  @@index([chapter_id], map: "idx_chapter_id")
  @@index([user_id], map: "idx_user_id")
  @@index([created_at], map: "idx_created_at")
  @@index([comic_id, created_at], map: "idx_comic_created")
  @@index([chapter_id, created_at], map: "idx_chapter_created")
}

model User {
  id               BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  username         String?    @unique @db.VarChar(50)
  email            String?    @unique @db.VarChar(255)
  phone            String?    @unique @db.VarChar(20)
  password         String?    @db.VarChar(255)
  status           UserStatus @default(active)
  email_verified_at DateTime? @db.DateTime(0)
  phone_verified_at DateTime? @db.DateTime(0)
  last_login_at    DateTime?  @db.DateTime(0)
  remember_token   String?    @db.VarChar(100)
  created_user_id  BigInt?    @db.UnsignedBigInt
  updated_user_id  BigInt?    @db.UnsignedBigInt
  created_at       DateTime   @default(now()) @db.DateTime(0)
  updated_at       DateTime   @updatedAt @db.DateTime(0)
  deleted_at       DateTime?  @db.DateTime(0)

  comments         Comment[]
  reviews          ComicReview[]
  views            ComicView[]

  @@map("users")
  @@index([deleted_at], map: "idx_deleted_at")
}

